<html>
    <head>
        <% include partials/nav.ejs %>      
        <script src="/script.js"></script>  
    </head>
    <body>
        <div class="container">
            <form id = "work_schedule_capture">
                
                <%console.log(shiftResults) %>
                <div class="row">
                    <div class="col-lg-6">
                        <div class="input-group">
                            <span class="input-group-addon" id="sizing-addon2">Site Name</span>
                            <select class="form-control"name="siteName"id="siteName">
                                <% siteResults.forEach(function( eachResult){ %>
                                <option value=<%= eachResult.S_name %> > <%= eachResult.S_name %></option>
                                
                                <% }) %>
                                <option>Add New Site...</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-6">
                        <div class="input-group">
                            <span class="input-group-addon" id="sizing-addon2">Site Address</span>
                            <input type="text" class="form-control" name="siteAddress" id="siteAddress"value="">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-6">
                        <div class="input-group">
                            <span class="input-group-addon" id="sizing-addon2">Employer Name</span>
                            <select class="form-control"name="invoiceOccurence"id="invoiceOccurence">
                                <% employerResults.forEach(function( eachResult){ %>
                                <option value=<%= eachResult.E_name %> > <%= eachResult.E_name %></option>
                                <% }) %>
                                <option>Add Employer...</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-6">
                        <div class="input-group">
                            <span class="input-group-addon" id="sizing-addon2">Employer E-Mail</span>
                            <input type="email" class="form-control" name="employerEmail" id="employerEmail"value="">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-6">
                        <div class="input-group">
                            <span class="input-group-addon" id="sizing-addon2">Send Invoice</span>
                            <select class="form-control"name="invoiceOccurence"id="invoiceOccurence">
                                <option value="Monday">Monday</option>
                                <option value="Tuesday">Tuesday</option>
                                <option value="Wednesday">Wednesday</option>
                                <option value="Thursday">Thursday</option>
                                <option value="Friday">Friday</option>
                                <option value="Saturday">Saturday</option>
                                <option value="Sunday">Sunday</option>
                            </select>
                            <input type="text" class="form-control" name="Invoicetime" id="Invoicetime" value="00:00:00">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <br>
                </div>
                <table class="table">
                        <thead class="thead-dark">
                            <tr>
                                <th>Day</th>
                                <th>Start Time<input type="checkbox" name="startTime" value="startTime" onclick="fillStartTimes()"></th>
                                <th>End Time<input type="checkbox" name="EndTime" id="EndTime" value="endTime" onclick="fillEndTimes()"></th>
                                <th>Hours Worked</th>
                                <th>Hourly Rate<input type="checkbox" name="hourlyRate" id="hourlyRate" value="hourlyRate" onclick="validateHourlyRate()"></th>
                            </tr>
                        </thead>
                        <% shiftResults.forEach(function(eachResult){ %>
                            <%if(eachResult.day=="Monday"){ %>
                                <tr>
                                    <td><input type="text" name="firstDay" value="Monday" disabled></td>
                                    <td><input type="text" name="monStrtTime" id="monStrtTime" value=<%= eachResult.start_time %> onkeyup="validateMondayStartTime()"></td>
                                    <td><input type="text" name="monEndtTime" id="monEndTime" value=<%= eachResult.end_time %> onkeyup="validateMondayEndTime()"></td>
                                    <td><input type="text" name="monTimeWorked" value=<%= eachResult.hrs_work %> id="monTimeWorked"></td>
                                    <td><input type="text" name="monHourlyRate" value=<%= eachResult.H_rate %> id="monHourlyRate"></td>
                                </tr>
                            <% } %>
                            <%if(eachResult.day=="Tuesday"){ %>
                                <tr>
                                    <td><input type="text" name="SecoundDay" value="Tuesday" disabled></td>
                                    <td><input type="text" name="tueStrtTime" value=<%= eachResult.start_time %> id="tueStrtTime"></td>
                                    <td><input type="text" name="tueEndtTime" value=<%= eachResult.end_time %> id="tueEndTime"></td>
                                    <td><input type="text" name="tueTimeWorked" value=<%= eachResult.hrs_work %> id="tueTimeWorked"></td>
                                    <td><input type="text" name="tueHourlyRate" value=<%= eachResult.H_rate %> id="tueHourlyRate"></td>
                                </tr>
                            <% } %>
                            <%if(eachResult.day=="Wednesday"){ %>
                                <tr>
                                    <td><input type="text" name="ThirdDay" value="Wednesday" disabled></td>
                                    <td><input type="text" name="wedStrtTime" value=<%= eachResult.start_time %> id="wedStrtTime"></td>
                                    <td><input type="text" name="wedEndtTime" value=<%= eachResult.end_time %> id="wedEndTime"></td>
                                    <td><input type="text" name="wedTimeWorked" value=<%= eachResult.hrs_work %> id="wedTimeWorked"></td>
                                    <td><input type="text" name="wedHourlyRate" value=<%= eachResult.H_rate %> id="wedHourlyRate"></td>
                                </tr>
                            <% } %>
                            <%if(eachResult.day=="Thursday"){ %>
                                <tr>
                                    <td><input type="text" name="FourthDay" value="Thursday" disabled></td>
                                    <td><input type="text" name="thuStrtTime" value=<%= eachResult.start_time %> id="thuStrtTime"></td>
                                    <td><input type="text" name="thuEndtTime" value=<%= eachResult.end_time %> id="thuEndTime"></td>
                                    <td><input type="text" name="thuTimeWorked" value=<%= eachResult.hrs_work %> id="thuTimeWorked"></td>
                                    <td><input type="text" name="thuHourlyRate" value=<%= eachResult.H_rate %> id="thuHourlyRate"></td>
                                </tr>
                            <% } %>
                            <%if(eachResult.day=="Friday"){ %>
                                <tr>
                                    <td><input type="text" name="FifthDay" value="Friday" disabled></td>
                                    <td><input type="text" name="friStrtTime" value=<%= eachResult.start_time %> id="friStrtTime"></td>
                                    <td><input type="text" name="friEndtTime" value=<%= eachResult.end_time %> id="friEndTime"></td>
                                    <td><input type="text" name="friTimeWorked" value=<%= eachResult.hrs_work %> id="friTimeWorked"></td>
                                    <td><input type="text" name="friHourlyRate" value=<%= eachResult.H_rate %> id="friHourlyRate"></td>
                                </tr>
                            <% } %>
                            <%if(eachResult.day=="Saturday"){ %>
                                <tr>
                                    <td><input type="text" name="sixthDay" value="Saturday" disabled></td>
                                    <td><input type="text" name="satStrtTime" value=<%= eachResult.start_time %> id="satStrtTime"></td>
                                    <td><input type="text" name="satEndtTime" value=<%= eachResult.end_time %> id="satEndTime"></td>
                                    <td><input type="text" name="satTimeWorked" value=<%= eachResult.hrs_work %> id="satTimeWorked"></td>
                                    <td><input type="text" name="satHourlyRate" value=<%= eachResult.H_rate %> id="satHourlyRate"></td>
                                </tr>
                            <% } %>
                            <%if(eachResult.day=="Sunday"){ %>
                                <tr>
                                        <td><input type="text" name="seventhDay" value="Sunday" disabled></td>
                                        <td><input type="text" name="sunStrtTime" value=<%= eachResult.start_time %> id="sunStrtTime"></td>
                                        <td><input type="text" name="sunEndtTime" value=<%= eachResult.end_time %> id="sunEndTime"></td>
                                        <td><input type="text" name="sunTimeWorked" value=<%= eachResult.hrs_work %> id="sunTimeWorked"></td>
                                        <td><input type="text" name="sunHourlyRate" value=<%= eachResult.H_rate %> id="sunHourlyRate"></td>
                                </tr>
                            <% } %>
                        <% }) %>
                </table><br>
                <button type="submit" class="btn btn-primary" name="back" formaction="/work_schedule">Back</button>
                <button type="submit" class="btn btn-primary" name="insertWorkSchedule">Save</button>
            </form>
        </div>
        <script>
                function validateMondayStartTime(){
                    let fieldValue = document.getElementById("monStrtTime").value;
                    validateTime(fieldValue,"monStrtTime");
                    calculateHoursWorked(document.getElementById("monStrtTime").value,document.getElementById("monEndTime").value,"monTimeWorked");
                }
                function validateMondayEndTime(){
                    let fieldValue = document.getElementById("monEndTime").value;
                    validateTime(fieldValue,"monEndTime");
                    calculateHoursWorked(document.getElementById("monStrtTime").value,document.getElementById("monEndTime").value,"monTimeWorked");    
                }            
                function validateTime(timeValue,tagID){          
                    let dayTime = timeValue;
                    let timeLen = dayTime.length;
                    console.log(timeLen);
                    console.log(tagID);
                    if(timeLen != 0 || timeLen != undefined){
                        let validatedTime = "";
                        let colonPosition = dayTime.search(":");
                        
                        for(let i = 0; i !== timeLen; i++){
                            var x = dayTime.substring(i, i + 1);
                            console.log(x);
                            if (i !== 2){
                                if (!isNumber(x)){
                                    console.log(x +" Is not a number");
                                }else if(isNumber(x)){
                                    validatedTime = validatedTime + x;
                                }
                            }else if (i == 2){
                                validatedTime = validatedTime + x;
                            }                                                
                        }                    
                        let validatedTimeLen = validatedTime.length;
                        //console.log(validatedTimeLen + " is the length of the validateTime string");
                        if( validatedTimeLen == 2){
                            //console.log(" Put the Colen Now!");
                            validatedTime = validatedTime + ":";
                            console.log(validatedTime);                        
                            document.getElementById(tagID).value = validatedTime;                         
                        }if( validatedTimeLen > 5){
                            //alert("Time should be HH:MM only!");
                            validatedTime = validatedTime.slice(0,5);
                            document.getElementById(tagID).value = validatedTime;
                        }else{
                            document.getElementById(tagID).value = validatedTime;
                        }
                        console.log(validatedTime);
                    }                                  
                }
                function isNumber(letter){
                    let input = letter;
                    if ((input >= 0) && (input <= 9) ){
                        return true;
                    }else{
                        return false;
                    } 
                }   
                function fillStartTimes(){
                    let mondayStartTime = document.getElementById("monStrtTime").value;
                    console.log(mondayStartTime);
                    document.getElementById("tueStrtTime").value = mondayStartTime;
                    document.getElementById("wedStrtTime").value = mondayStartTime;
                    document.getElementById("thuStrtTime").value = mondayStartTime;
                    document.getElementById("friStrtTime").value = mondayStartTime;
                    document.getElementById("satStrtTime").value = mondayStartTime;
                    document.getElementById("sunStrtTime").value = mondayStartTime;
                }
                function fillEndTimes(){
                    let mondayEndTime = document.getElementById("monEndTime").value;
                    console.log(mondayEndTime);
                    document.getElementById("tueEndTime").value = mondayEndTime;
                    document.getElementById("wedEndTime").value = mondayEndTime;
                    document.getElementById("thuEndTime").value = mondayEndTime;
                    document.getElementById("friEndTime").value = mondayEndTime;
                    document.getElementById("satEndTime").value = mondayEndTime;
                    document.getElementById("sunEndTime").value = mondayEndTime;
                }
                function calculateHoursWorked(start,end,tagID){
                    let hoursWorked;
                    //console.log("Started working at : " + start," Finished working at : " + end);
                    if((start.length == 5) && (end.length == 5)){
                        let startTime = start.replace(":",".");
                        let endTime = end.replace(":",".");
                        if(endTime >= startTime){
                            hoursWorked = endTime - startTime;
                            //return hoursWorked;
                            document.getElementById(tagID).value = hoursWorked;
                            console.log("You worked : " + hoursWorked + " hours...");
                        }
                    }else{
                            document.getElementById(tagID).value = "0";
                    } 
                    /*
                    if((start != "") && (start != undefined) && (end != "") && (end != undefined)){
                        console.log("Started working at : " + start," Finished working at : " + end);
                        if(end>=start){
                            hoursWorked = end - start;
                            //return hoursWorked;
                            console.log(hoursWorked);
                        } 
                    }if((start = "") && (start = undefined) && (end = "") && (end = undefined)){
                        console.log("One or more fields are empty to calculate hours worked")
                        if(end<start){
                            hoursWorked = end - start;
                            //return hoursWorked;
                            console.log("End time cannot be less than start time");
                        }    
                    }
                    */
                }
                function fillHourlyRate(){
                    let mondayHourlyRate = document.getElementById("monHourlyRate").value;
                    console.log(mondayHourlyRate);
                    document.getElementById("tueHourlyRate").value = mondayHourlyRate;
                    document.getElementById("wedHourlyRate").value = mondayHourlyRate;
                    document.getElementById("thuHourlyRate").value = mondayHourlyRate;
                    document.getElementById("friHourlyRate").value = mondayHourlyRate;
                    document.getElementById("satHourlyRate").value = mondayHourlyRate;
                    document.getElementById("sunHourlyRate").value = mondayHourlyRate;
                }
                function validateHourlyRate(){
                    let elementValue = document.getElementById("hourlyRate");
                    console.log("Hourly rate checked true");
                    if (elementValue.checked == true){
                        fillHourlyRate();
                    }
                }
        </script> 
    </body>
</html>